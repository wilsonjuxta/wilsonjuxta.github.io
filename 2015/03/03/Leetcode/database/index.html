<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="wilsonjax_t的流年祭"><title>Leetcode database problemset | wilsonjax_t</title><link rel="stylesheet" type="text/css" href="/css/normalize.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/pure-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Leetcode database problemset</h1><a id="logo" href="/.">wilsonjax_t</a><p class="description">坚持就是一天，又一天。你告诉自己，再坚持一天。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Leetcode database problemset</h1><div class="post-meta">Mar 3, 2015<span> | </span><span class="category"><a href="/categories/Study/">Study</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2015/03/03/Leetcode/database/" href="/2015/03/03/Leetcode/database/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p>过年好久没有刷题,手都生疏了,sad…这几天正好闲的没事,准备把<a href="https://oj.leetcode.com" target="_blank" rel="external">leetcode</a>刷刷。Algorithm部分太多了,慢慢总结。先把<a href="https://oj.leetcode.com/problemset/database/" target="_blank" rel="external">Database</a>部分总结一下吧～</p>
<p>Database篇,按难度来总结:</p>
<h2 id="Combine-Two-Tables-Easy"><a href="#Combine-Two-Tables-Easy" class="headerlink" title="Combine Two Tables (Easy)"></a>Combine Two Tables (Easy)</h2><p>Description:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="header">Table: Person</span><br><span class="line">+-------------+---------+</span></span><br><span class="line"><span class="header">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span></span><br><span class="line">| PersonId    | int     |</span><br><span class="line">| FirstName   | varchar |</span><br><span class="line"><span class="header">| LastName    | varchar |</span><br><span class="line">+-------------+---------+</span></span><br><span class="line">PersonId is the primary key column for this table</span><br><span class="line"><span class="header">Table: Address</span><br><span class="line">+-------------+---------+</span></span><br><span class="line"><span class="header">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span></span><br><span class="line">| AddressId   | int     |</span><br><span class="line">| PersonId    | int     |</span><br><span class="line">| City        | varchar |</span><br><span class="line"><span class="header">| State       | varchar |</span><br><span class="line">+-------------+---------+</span></span><br><span class="line">AddressId is the primary key column for this table.</span><br></pre></td></tr></table></figure></p>
<p>Q:Write a SQL query for a report that provides the following information for each person in the Person table, regardless if there is an address for each of those people:</p>
<p>A:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> FirstName,LastName,Address.City,Address.State <span class="keyword">from</span> Person <span class="keyword">left</span> <span class="keyword">join</span> Address <span class="keyword">on</span> Person.PersonId = Address.PersonId;</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="Customers-Who-Never-Order-Easy"><a href="#Customers-Who-Never-Order-Easy" class="headerlink" title="Customers Who Never Order (Easy)"></a>Customers Who Never Order (Easy)</h2><p>Description:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="header">Table: Customers.</span><br><span class="line">+----+-------+</span></span><br><span class="line"><span class="header">| Id | Name  |</span><br><span class="line">+----+-------+</span></span><br><span class="line">| 1  | Joe   |</span><br><span class="line">| 2  | Henry |</span><br><span class="line">| 3  | Sam   |</span><br><span class="line"><span class="header">| 4  | Max   |</span><br><span class="line">+----+-------+</span></span><br><span class="line"><span class="header">Table: Orders.</span><br><span class="line">+----+------------+</span></span><br><span class="line"><span class="header">| Id | CustomerId |</span><br><span class="line">+----+------------+</span></span><br><span class="line">| 1  | 3          |</span><br><span class="line"><span class="header">| 2  | 1          |</span><br><span class="line">+----+------------+</span></span><br></pre></td></tr></table></figure></p>
<p>Q:Write a SQL query to find all customers who never order anything.<br>A:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">Name</span> <span class="keyword">from</span> Customers <span class="keyword">where</span> Customers.<span class="keyword">Id</span> <span class="keyword">Not</span> <span class="keyword">in</span> (<span class="keyword">select</span> CustomerId <span class="keyword">from</span> Orders);</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="Duplicate-Emails-Easy"><a href="#Duplicate-Emails-Easy" class="headerlink" title="Duplicate Emails (Easy)"></a>Duplicate Emails (Easy)</h2><p>Description:<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Table</span>: Person</span><br><span class="line">+----+---------+</span><br><span class="line">| Id | Email   |</span><br><span class="line">+----+---------+</span><br><span class="line">| <span class="number">1</span>  | a<span class="variable">@b</span>.com |</span><br><span class="line">| <span class="number">2</span>  | c<span class="variable">@d</span>.com |</span><br><span class="line">| <span class="number">3</span>  | a<span class="variable">@b</span>.com |</span><br><span class="line">+----+---------+</span><br></pre></td></tr></table></figure></p>
<p>Q:Write a SQL query to find all duplicate emails in a table named Person.<br>A:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">#way1: <span class="operator"><span class="keyword">SELECT</span> Email <span class="keyword">FROM</span> Person <span class="keyword">GROUP</span> <span class="keyword">BY</span> Email <span class="keyword">Having</span> <span class="keyword">COUNT</span>(Email)&gt;<span class="number">1</span>;</span></span><br><span class="line">#way2:</span><br><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> a.Email <span class="keyword">FROM</span> Person a <span class="keyword">JOIN</span> Person b <span class="keyword">ON</span> (a.Email=b.Email <span class="keyword">and</span> a.<span class="keyword">Id</span>&lt;&gt;b.<span class="keyword">Id</span>);</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="Employees-Earning-More-Than-Their-Managers-Easy"><a href="#Employees-Earning-More-Than-Their-Managers-Easy" class="headerlink" title="Employees Earning More Than Their Managers (Easy)"></a>Employees Earning More Than Their Managers (Easy)</h2><p>Description:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">The Employee table holds all employees including their managers. Every employee has an Id, and there is also a column for the manager Id.</span><br><span class="line"><span class="header">Table: Employee</span><br><span class="line">+----+-------+--------+-----------+</span></span><br><span class="line"><span class="header">| Id | Name  | Salary | ManagerId |</span><br><span class="line">+----+-------+--------+-----------+</span></span><br><span class="line">| 1  | Joe   | 70000  | 3         |</span><br><span class="line">| 2  | Henry | 80000  | 4         |</span><br><span class="line">| 3  | Sam   | 60000  | NULL      |</span><br><span class="line"><span class="header">| 4  | Max   | 90000  | NULL      |</span><br><span class="line">+----+-------+--------+-----------+</span></span><br></pre></td></tr></table></figure></p>
<p>Q:Given the Employee table, write a SQL query that finds out employees who earn more than their managers. For the above table, Joe is the only employee who earns more than his manager.<br>A:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">#way1: <span class="operator"><span class="keyword">SELECT</span> a.<span class="keyword">Name</span> <span class="keyword">FROM</span> Employee a ,Employee b <span class="keyword">WHERE</span> a.ManagerId = b.<span class="keyword">Id</span> <span class="keyword">AND</span> a.Salary&gt;b.Salary;</span></span><br><span class="line">#way2:</span><br><span class="line"><span class="operator"><span class="keyword">select</span> a.<span class="keyword">Name</span> <span class="keyword">from</span> Employee a <span class="keyword">inner</span> <span class="keyword">join</span> Employee b <span class="keyword">on</span> a.ManagerId=b.<span class="keyword">Id</span> <span class="keyword">where</span> a.Salary&gt;b.Salary;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Second-Highest-Salary-Easy"><a href="#Second-Highest-Salary-Easy" class="headerlink" title="Second Highest Salary (Easy)"></a>Second Highest Salary (Easy)</h2><p>Description:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="header">Table: Employee</span><br><span class="line">+----+--------+</span></span><br><span class="line"><span class="header">| Id | Salary |</span><br><span class="line">+----+--------+</span></span><br><span class="line">| 1  | 100    |</span><br><span class="line">| 2  | 200    |</span><br><span class="line"><span class="header">| 3  | 300    |</span><br><span class="line">+----+--------+</span></span><br></pre></td></tr></table></figure></p>
<p>Q:Write a SQL query to get the second highest salary from the Employee table.<br>A:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">max</span>(a.Salary) <span class="keyword">FROM</span> Employee a <span class="keyword">where</span> a.Salary &lt; (<span class="keyword">select</span> <span class="keyword">max</span>(b.Salary) <span class="keyword">from</span> Employee b) ;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Consecutive-Numbers-Medium"><a href="#Consecutive-Numbers-Medium" class="headerlink" title="Consecutive Numbers (Medium)"></a>Consecutive Numbers (Medium)</h2><p>Description:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="header">Table: Logs</span><br><span class="line">+----+-----+</span></span><br><span class="line"><span class="header">| Id | Num |</span><br><span class="line">+----+-----+</span></span><br><span class="line">| 1  |  1  |</span><br><span class="line">| 2  |  1  |</span><br><span class="line">| 3  |  1  |</span><br><span class="line">| 4  |  2  |</span><br><span class="line">| 5  |  1  |</span><br><span class="line">| 6  |  2  |</span><br><span class="line"><span class="header">| 7  |  2  |</span><br><span class="line">+----+-----+</span></span><br></pre></td></tr></table></figure></p>
<p>Q:Write a SQL query to find all numbers that appear at least three times consecutively.<br>A:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">distinct</span> <span class="keyword">Num</span> <span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> <span class="keyword">Num</span>,</span><br><span class="line">    <span class="keyword">case</span></span><br><span class="line">        <span class="keyword">when</span> @pre=<span class="keyword">Num</span> <span class="keyword">then</span> @<span class="keyword">count</span>:=@<span class="keyword">count</span>+<span class="number">1</span></span><br><span class="line">        <span class="keyword">when</span> @pre:=<span class="keyword">Num</span> <span class="keyword">then</span> @<span class="keyword">count</span>:=<span class="number">1</span></span><br><span class="line">        <span class="keyword">when</span> @<span class="keyword">count</span>:=<span class="number">1</span> <span class="keyword">then</span> @<span class="keyword">count</span></span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">as</span> total </span><br><span class="line">    <span class="keyword">from</span> <span class="keyword">Logs</span> ,(<span class="keyword">select</span> @<span class="keyword">count</span>:=<span class="number">0</span>,@pre:=<span class="literal">null</span>) r</span><br><span class="line">) a <span class="keyword">where</span> a.total&gt;=<span class="number">3</span>;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Department-Highest-Salary-Medium"><a href="#Department-Highest-Salary-Medium" class="headerlink" title="Department Highest Salary (Medium)"></a>Department Highest Salary (Medium)</h2><p>Description:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">The Employee table holds all employees. Every employee has an Id, a salary, and there is also a column for the department Id.</span><br><span class="line"><span class="header">Table: Employee</span><br><span class="line">+----+-------+--------+--------------+</span></span><br><span class="line"><span class="header">| Id | Name  | Salary | DepartmentId |</span><br><span class="line">+----+-------+--------+--------------+</span></span><br><span class="line">| 1  | Joe   | 70000  | 1            |</span><br><span class="line">| 2  | Henry | 80000  | 2            |</span><br><span class="line">| 3  | Sam   | 60000  | 2            |</span><br><span class="line"><span class="header">| 4  | Max   | 90000  | 1            |</span><br><span class="line">+----+-------+--------+--------------+</span></span><br><span class="line">The Department table holds all departments of the company.</span><br><span class="line"><span class="header">Table: Department</span><br><span class="line">+----+----------+</span></span><br><span class="line"><span class="header">| Id | Name     |</span><br><span class="line">+----+----------+</span></span><br><span class="line">| 1  | IT       |</span><br><span class="line"><span class="header">| 2  | Sales    |</span><br><span class="line">+----+----------+</span></span><br></pre></td></tr></table></figure></p>
<p>Q:Write a SQL query to find employees who have the highest salary in each of the departments. For the above tables, Max has the highest salary in the IT department and Henry has the highest salary in the Sales department.<br>A:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">select</span> b.<span class="keyword">Name</span>,a.<span class="keyword">Name</span>,a.Salary <span class="keyword">from</span> Department b ,Employee a,</span><br><span class="line">(<span class="keyword">select</span> DepartmentId,<span class="keyword">Name</span>,<span class="keyword">max</span>(Salary) <span class="keyword">as</span> maxs <span class="keyword">from</span> Employee <span class="keyword">group</span> <span class="keyword">by</span> DepartmentId) <span class="keyword">c</span></span><br><span class="line"><span class="keyword">where</span> a.DepartmentId = <span class="keyword">c</span>.DepartmentId <span class="keyword">and</span></span><br><span class="line">    a.Salary = <span class="keyword">c</span>.maxs <span class="keyword">and</span></span><br><span class="line">    a.DepartmentId = b.<span class="keyword">Id</span>;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Nth-Highest-Salary-Medium"><a href="#Nth-Highest-Salary-Medium" class="headerlink" title="Nth Highest Salary (Medium)"></a>Nth Highest Salary (Medium)</h2><p>Description:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="header">Table: Employee</span><br><span class="line">+----+--------+</span></span><br><span class="line"><span class="header">| Id | Salary |</span><br><span class="line">+----+--------+</span></span><br><span class="line">| 1  | 100    |</span><br><span class="line">| 2  | 200    |</span><br><span class="line"><span class="header">| 3  | 300    |</span><br><span class="line">+----+--------+</span></span><br></pre></td></tr></table></figure></p>
<p>Q:Write a SQL query to get the nth highest salary from the Employee table.<br>A:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> getNthHighestSalary(<span class="keyword">N</span> <span class="built_in">INT</span>) <span class="keyword">RETURNS</span> <span class="built_in">INT</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">RETURN</span> (</span><br><span class="line">    <span class="keyword">select</span> Salary <span class="keyword">from</span></span><br><span class="line">    (<span class="keyword">select</span> Salary,</span><br><span class="line">    <span class="keyword">case</span> </span><br><span class="line">        <span class="keyword">when</span> @Salary=Salary <span class="keyword">then</span> @<span class="keyword">rank</span> </span><br><span class="line">        <span class="keyword">when</span> @Salary:=Salary <span class="keyword">then</span> @<span class="keyword">rank</span>:=@<span class="keyword">rank</span>+<span class="number">1</span> </span><br><span class="line">        <span class="keyword">when</span> @<span class="keyword">rank</span>:=@<span class="keyword">rank</span>+<span class="number">1</span> <span class="keyword">then</span> @<span class="keyword">rank</span> </span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">as</span> <span class="keyword">Rank</span> <span class="keyword">From</span> Employee b,(<span class="keyword">select</span> @<span class="keyword">rank</span>:=<span class="number">0</span>,@Salary:=<span class="literal">null</span>)a </span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> Salary <span class="keyword">desc</span>)<span class="keyword">c</span> <span class="keyword">where</span> <span class="keyword">c</span>.<span class="keyword">Rank</span>=<span class="keyword">N</span> <span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line">  );</span></span><br><span class="line"><span class="operator"><span class="keyword">END</span></span></span><br></pre></td></tr></table></figure></p>
<h2 id="Rank-Scores-Medium"><a href="#Rank-Scores-Medium" class="headerlink" title="Rank Scores (Medium)"></a>Rank Scores (Medium)</h2><p>Description:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="header">Table: Scores</span><br><span class="line">+----+-------+</span></span><br><span class="line"><span class="header">| Id | Score |</span><br><span class="line">+----+-------+</span></span><br><span class="line">| 1  | 3.50  |</span><br><span class="line">| 2  | 3.65  |</span><br><span class="line">| 3  | 4.00  |</span><br><span class="line">| 4  | 3.85  |</span><br><span class="line">| 5  | 4.00  |</span><br><span class="line"><span class="header">| 6  | 3.65  |</span><br><span class="line">+----+-------+</span></span><br></pre></td></tr></table></figure></p>
<p>Q:Write a SQL query to rank scores. If there is a tie between two scores, both should have the same ranking. Note that after a tie, the next ranking number should be the next consecutive integer value. In other words, there should be no “holes” between ranks.<br>A:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="operator"><span class="keyword">select</span> Score,</span><br><span class="line"><span class="keyword">case</span></span><br><span class="line">    <span class="keyword">when</span> @score=Score <span class="keyword">then</span> @<span class="keyword">rank</span></span><br><span class="line">    <span class="keyword">when</span> @score:=Score  <span class="keyword">then</span> @<span class="keyword">rank</span>:=@<span class="keyword">rank</span>+<span class="number">1</span></span><br><span class="line">    <span class="keyword">when</span> @<span class="keyword">rank</span>:=@<span class="keyword">rank</span>+<span class="number">1</span> <span class="keyword">then</span> @<span class="keyword">rank</span></span><br><span class="line"><span class="keyword">end</span> <span class="keyword">as</span> <span class="keyword">Rank</span> <span class="keyword">From</span> Scores ,(<span class="keyword">select</span> @<span class="keyword">rank</span>:=<span class="number">0</span>,@score:=<span class="literal">NULL</span>) a</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> Score <span class="keyword">desc</span>;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Department-Top-Three-Salaries-Hard"><a href="#Department-Top-Three-Salaries-Hard" class="headerlink" title="Department Top Three Salaries (Hard)"></a>Department Top Three Salaries (Hard)</h2><p>Description:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">The Employee table holds all employees. Every employee has an Id, and there is also a column for the department Id.</span><br><span class="line"><span class="header">Table : Employee</span><br><span class="line">+----+-------+--------+--------------+</span></span><br><span class="line"><span class="header">| Id | Name  | Salary | DepartmentId |</span><br><span class="line">+----+-------+--------+--------------+</span></span><br><span class="line">| 1  | Joe   | 70000  | 1            |</span><br><span class="line">| 2  | Henry | 80000  | 2            |</span><br><span class="line">| 3  | Sam   | 60000  | 2            |</span><br><span class="line">| 4  | Max   | 90000  | 1            |</span><br><span class="line">| 5  | Janet | 69000  | 1            |</span><br><span class="line"><span class="header">| 6  | Randy | 85000  | 1            |</span><br><span class="line">+----+-------+--------+--------------+</span></span><br><span class="line">The Department table holds all departments of the company.</span><br><span class="line"><span class="header">Table : Department</span><br><span class="line">+----+----------+</span></span><br><span class="line"><span class="header">| Id | Name     |</span><br><span class="line">+----+----------+</span></span><br><span class="line">| 1  | IT       |</span><br><span class="line"><span class="header">| 2  | Sales    |</span><br><span class="line">+----+----------+</span></span><br></pre></td></tr></table></figure></p>
<p>Q:Write a SQL query to find employees who earn the top three salaries in each of the department. For the above tables, your SQL query should return the following rows.<br>A:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># amazing= =..不知道怎么乱搞就accept了。。。</span><br><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">c</span>.<span class="keyword">Name</span>,b.<span class="keyword">Name</span>,Salary <span class="keyword">from</span> Department <span class="keyword">c</span>, (</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">Name</span>,DepartmentId,Salary,</span><br><span class="line"><span class="keyword">case</span></span><br><span class="line">    <span class="keyword">when</span> @salary=Salary <span class="keyword">and</span> @depid=DepartmentId <span class="keyword">then</span> @<span class="keyword">rank</span></span><br><span class="line">    <span class="keyword">when</span> @salary=Salary <span class="keyword">and</span> @depid&lt;&gt;@depid:=DepartmentId <span class="keyword">then</span> @<span class="keyword">rank</span>:=<span class="number">1</span></span><br><span class="line">    <span class="keyword">when</span> @salary:=Salary <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">case</span></span><br><span class="line">        <span class="keyword">when</span> @depid=DepartmentId <span class="keyword">then</span> @<span class="keyword">rank</span>:=@<span class="keyword">rank</span>+<span class="number">1</span></span><br><span class="line">        <span class="keyword">when</span> @depid:=DepartmentId <span class="keyword">then</span> @<span class="keyword">rank</span>:=<span class="number">1</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">when</span> @depid=DepartmentId <span class="keyword">then</span> @<span class="keyword">rank</span>:=@<span class="keyword">rank</span>+<span class="number">1</span></span><br><span class="line">    <span class="keyword">when</span> @depid:=DepartmentId <span class="keyword">then</span> @<span class="keyword">rank</span>:=<span class="number">1</span></span><br><span class="line"><span class="keyword">end</span> <span class="keyword">as</span> <span class="keyword">rank</span> <span class="keyword">from</span> Employee ,(<span class="keyword">select</span> @<span class="keyword">rank</span>:=<span class="number">0</span>,@salary:=<span class="literal">null</span>,@depid:=<span class="literal">null</span>)a</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> DepartmentId <span class="keyword">asc</span>,Salary <span class="keyword">desc</span>)b <span class="keyword">where</span> b.DepartmentId=<span class="keyword">c</span>.<span class="keyword">Id</span> <span class="keyword">and</span> b.<span class="keyword">rank</span>&lt;=<span class="number">3</span></span></span><br></pre></td></tr></table></figure></p>
</div><a data-url="http://wilsonjuxta.github.io/2015/03/03/Leetcode/database/" data-id="ciuwggmk6001tabxrx90qhfx2" class="article-share-link">分享到</a><div class="tags"><a href="/tags/leetcode/">leetcode</a><a href="/tags/mysql/">mysql</a></div><div class="post-nav"><a href="/2015/03/04/Leetcode/Medium/Add-Two-Numbers/" class="pre">Leetcode Algorithms -- Add Two Numbers</a><a href="/2015/03/03/algorithm1/" class="next">八大排序方法小结</a></div><div id="disqus_thread"><script>var disqus_shortname = 'Tamara';
var disqus_identifier = '2015/03/03/Leetcode/database/';
var disqus_title = 'Leetcode database problemset';
var disqus_url = 'http://wilsonjuxta.github.io/2015/03/03/Leetcode/database/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//Tamara.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="sitesearch" value="http://wilsonjuxta.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Study/">Study</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/life/">life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/urllink/">urllink</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Bit-Manipulation/" style="font-size: 15px;">Bit Manipulation</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/thinkphp/" style="font-size: 15px;">thinkphp</a> <a href="/tags/qlcoder/" style="font-size: 15px;">qlcoder</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/杂谈/" style="font-size: 15px;">杂谈</a> <a href="/tags/leetcode/" style="font-size: 15px;">leetcode</a> <a href="/tags/lamp/" style="font-size: 15px;">lamp</a> <a href="/tags/codeblocks/" style="font-size: 15px;">codeblocks</a> <a href="/tags/algorithm/" style="font-size: 15px;">algorithm</a> <a href="/tags/排序/" style="font-size: 15px;">排序</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/动态规划/" style="font-size: 15px;">动态规划</a> <a href="/tags/模拟/" style="font-size: 15px;">模拟</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/二分搜索/" style="font-size: 15px;">二分搜索</a> <a href="/tags/Linked-List/" style="font-size: 15px;">Linked List</a> <a href="/tags/回溯/" style="font-size: 15px;">回溯</a> <a href="/tags/二分/" style="font-size: 15px;">二分</a> <a href="/tags/递归/" style="font-size: 15px;">递归</a> <a href="/tags/数论/" style="font-size: 15px;">数论</a> <a href="/tags/Greedy/" style="font-size: 15px;">Greedy</a> <a href="/tags/stack/" style="font-size: 15px;">stack</a> <a href="/tags/hash/" style="font-size: 15px;">hash</a> <a href="/tags/递推/" style="font-size: 15px;">递推</a> <a href="/tags/dfs/" style="font-size: 15px;">dfs</a> <a href="/tags/kmp/" style="font-size: 15px;">kmp</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/Less/" style="font-size: 15px;">Less</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/10/28/qlcode/">qlcode</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/04/18/leetcodeall/">LeetCode 解题索引</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/04/17/Leetcode/shell/">Leetcode shell problemset</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/07/Leetcode/Medium/Unique-Paths-II/">Leetcode Algorithms -- Unique Paths II</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/07/Leetcode/Medium/Unique-Paths/">Leetcode Algorithms -- Unique Paths</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/07/Leetcode/Easy/Reverse-Bits/">Leetcode Algorithms -- Reverse Bits</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/07/Leetcode/Medium/Path-Sum-II/">Leetcode Algorithms -- Path Sum II</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/06/Leetcode/Medium/Permutation-Sequence/">Leetcode Algorithms -- Permutation Sequence</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/06/Leetcode/Medium/Spiral-Matrix-II/">Leetcode Algorithms -- Spiral Matrix II</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/06/Leetcode/Medium/Spiral-Matrix/">Leetcode Algorithms -- Spiral Matrix</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//Tamara.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">wilsonjax_t.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/jquery.min.js?v=0.0.0"></script><script type="text/javascript" src="/js/totop.js?v=0.0.0"></script><script type="text/javascript" src="/js/fancybox.pack.js?v=0.0.0"></script><script type="text/javascript" src="/js/jquery.fancybox.js?v=0.0.0"></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/share.js?v=0.0.0"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>